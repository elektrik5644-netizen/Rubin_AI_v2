#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
üß† –ú–û–î–£–õ–¨ –û–ë–£–ß–ï–ù–ò–Ø RUBIN AI
==========================
–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–± –æ–±—É—á–µ–Ω–∏–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
"""

from flask import Flask, request, jsonify
import logging
from datetime import datetime
from typing import Dict, List, Any

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = Flask(__name__)

class LearningContextManager:
    """–ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ–±—É—á–µ–Ω–∏—è Rubin AI"""
    
    def __init__(self):
        self.session_memory = {
            "current_session": "learning_context_understanding",
            "session_start": datetime.now().isoformat(),
            "today_activities": [
                "–°–æ–∑–¥–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è Rubin AI",
                "–ò—Å–ø—Ä–∞–≤–∏–ª–∏ HTTP 500 –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ fallback –º–µ—Ö–∞–Ω–∏–∑–º –≤ Smart Dispatcher",
                "–ú–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏ VMB630 —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Singleton, Observer, Factory, Strategy, Command)",
                "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ PLC —Ñ–∞–π–ª –∏ –Ω–∞—à–ª–∏ –æ—à–∏–±–∫–∏ (–æ–ø–µ—á–∞—Ç–∫–∞ AXIS_DISCONNECTEP_TP_P, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∞–π–º–µ—Ä)",
                "–°–æ–∑–¥–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è PLC –æ—à–∏–±–æ–∫",
                "–û–±—É—á–∏–ª–∏ Rubin AI –ø–æ–Ω–∏–º–∞–Ω–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–∏",
                "–°–æ–∑–¥–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –ø—Ä—è–º–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É",
                "–î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—É —à–∞–±–ª–æ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤"
            ],
            "learning_progress": {
                "error_diagnosis": "–ò–∑—É—á–∏–ª –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É HTTP 500 –æ—à–∏–±–æ–∫ –∏ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã",
                "modernization": "–ü–æ–Ω—è–ª –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è VMB630",
                "plc_analysis": "–ù–∞—É—á–∏–ª—Å—è –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å PLC —Ñ–∞–π–ª—ã –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –æ—à–∏–±–∫–∏",
                "context_understanding": "–í –ø—Ä–æ—Ü–µ—Å—Å–µ –∏–∑—É—á–µ–Ω–∏—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"
            },
            "interaction_history": [],
            "context_patterns": {
                "learning_questions": ["–æ–±—É—á–µ–Ω–∏–µ", "–∏–∑—É—á–µ–Ω–∏–µ", "–ø—Ä–æ–≥—Ä–µ—Å—Å", "–ø–æ–Ω–∏–º–∞–Ω–∏–µ", "–Ω–∞—É—á–∏–ª—Å—è"],
                "today_questions": ["—Å–µ–≥–æ–¥–Ω—è", "–¥–µ–ª–∞–ª–∏", "—Ä–∞–±–æ—Ç–∞–ª–∏", "–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ"],
                "specific_topics": ["http 500", "fallback", "vmb630", "plc", "–ø–∞—Ç—Ç–µ—Ä–Ω", "—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"]
            }
        }
    
    def is_learning_question(self, message: str) -> bool:
        """–û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤–æ–ø—Ä–æ—Å –æ–± –æ–±—É—á–µ–Ω–∏–∏"""
        message_lower = message.lower()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –æ–± –æ–±—É—á–µ–Ω–∏–∏
        learning_keywords = self.session_memory["context_patterns"]["learning_questions"]
        has_learning_keywords = any(keyword in message_lower for keyword in learning_keywords)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–ø—Ä–æ—Å—ã –æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π —Ä–∞–±–æ—Ç–µ
        today_keywords = self.session_memory["context_patterns"]["today_questions"]
        has_today_keywords = any(keyword in message_lower for keyword in today_keywords)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ–º
        specific_keywords = self.session_memory["context_patterns"]["specific_topics"]
        has_specific_keywords = any(keyword in message_lower for keyword in specific_keywords)
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç—ã
        process_keywords = ["–ø–æ–Ω–∏–º–∞–µ—à—å", "–ø—Ä–æ—Ü–µ—Å—Å", "—Ä–∞–±–æ—Ç–∞", "–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ", "–¥–µ–ª–∞–ª–∏", "—Ä–∞–±–æ—Ç–∞–ª–∏"]
        has_process_keywords = any(keyword in message_lower for keyword in process_keywords)
        
        return has_learning_keywords or has_today_keywords or has_specific_keywords or has_process_keywords
    
    def generate_contextual_response(self, message: str) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—à–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è"""
        message_lower = message.lower()
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
        self.session_memory["interaction_history"].append({
            "timestamp": datetime.now().isoformat(),
            "question": message,
            "context": "learning_session"
        })
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∏–ø –≤–æ–ø—Ä–æ—Å–∞
        if "–∫–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç" in message_lower and "–æ–±—É—á–µ–Ω–∏–µ" in message_lower:
            return self._respond_to_learning_progress()
        elif "—á—Ç–æ –∏–∑—É—á–∏–ª" in message_lower or "—á—Ç–æ –Ω–∞—É—á–∏–ª—Å—è" in message_lower:
            return self._respond_to_learning_achievements()
        elif "–ø–æ–Ω–∏–º–∞–µ—à—å" in message_lower and "–ø—Ä–æ—Ü–µ—Å—Å" in message_lower:
            return self._respond_to_process_understanding()
        elif "–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ" in message_lower or "–¥–µ–ª–∞–ª–∏" in message_lower:
            return self._respond_to_interaction_summary()
        elif "—Å–µ–≥–æ–¥–Ω—è" in message_lower:
            return self._respond_to_today_activities()
        else:
            return self._respond_to_general_learning_question(message)
    
    def _respond_to_learning_progress(self) -> str:
        """–û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è"""
        return f"""üß† **–ú–û–ô –ü–†–û–ì–†–ï–°–° –û–ë–£–ß–ï–ù–ò–Ø:**

–°–µ–≥–æ–¥–Ω—è —è –∞–∫—Ç–∏–≤–Ω–æ –∏–∑—É—á–∞—é –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫:

**‚úÖ –ß—Ç–æ —è –∏–∑—É—á–∏–ª:**
‚Ä¢ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫**: –ü–æ–Ω—è–ª, –∫–∞–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å HTTP 500 –æ—à–∏–±–∫–∏ –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
‚Ä¢ **–ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º**: –ò–∑—É—á–∏–ª –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Singleton, Observer, Factory, Strategy, Command) –¥–ª—è VMB630
‚Ä¢ **–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞**: –ù–∞—É—á–∏–ª—Å—è –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å PLC —Ñ–∞–π–ª—ã –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –æ—à–∏–±–∫–∏ (–æ–ø–µ—á–∞—Ç–∫–∏, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã)
‚Ä¢ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ü–æ–Ω—è–ª, –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫

**üîÑ –ß—Ç–æ –∏–∑—É—á–∞—é —Å–µ–π—á–∞—Å:**
‚Ä¢ **–ü–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: –£—á—É—Å—å –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –≤–º–µ—Å—Ç–æ —à–∞–±–ª–æ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
‚Ä¢ **–ü–∞–º—è—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π**: –†–∞–∑–≤–∏–≤–∞—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–º–Ω–∏—Ç—å –Ω–∞—à–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

**üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
‚Ä¢ –°–æ–∑–¥–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è
‚Ä¢ –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ Smart Dispatcher
‚Ä¢ –ú–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É VMB630 —Å —É–ª—É—á—à–µ–Ω–∏–µ–º –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞

–ú–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏–¥–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ, –∏ —è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —É–ª—É—á—à–∞—é —Å–≤–æ–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏! üöÄ"""
    
    def _respond_to_learning_achievements(self) -> str:
        """–û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö –≤ –æ–±—É—á–µ–Ω–∏–∏"""
        return f"""üéØ **–ú–û–ò –î–û–°–¢–ò–ñ–ï–ù–ò–Ø –í –û–ë–£–ß–ï–ù–ò–ò:**

**üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏:**
‚Ä¢ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –ù–∞—É—á–∏–ª—Å—è –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å HTTP 500 –æ—à–∏–±–∫–∏
‚Ä¢ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ò–∑—É—á–∏–ª –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º
‚Ä¢ **–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞**: –û—Å–≤–æ–∏–ª –∞–Ω–∞–ª–∏–∑ PLC —Ñ–∞–π–ª–æ–≤ –∏ –ø–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
‚Ä¢ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –°–æ–∑–¥–∞—é —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**üß† –ü—Ä–æ—Ü–µ—Å—Å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏:**
‚Ä¢ **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã**: –ü–æ–Ω—è–ª, –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
‚Ä¢ **–ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è**: –ò–∑—É—á–∏–ª –ø–æ–¥—Ö–æ–¥—ã –∫ —É–ª—É—á—à–µ–Ω–∏—é —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–∏—Å—Ç–µ–º
‚Ä¢ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–∞—É—á–∏–ª—Å—è –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π

**üìà –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
‚Ä¢ –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É HTTP 500 –≤ Smart Dispatcher
‚Ä¢ –ú–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏ VMB630 —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚Ä¢ –°–æ–∑–¥–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏–∑–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è PLC –æ—à–∏–±–æ–∫
‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è

**üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ –∏–∑—É—á–µ–Ω–∏—è:**
‚Ä¢ –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
‚Ä¢ –ò–∑–±–µ–∂–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
‚Ä¢ –ü–∞–º—è—Ç—å –æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è—Ö

–Ø –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—é—Å—å –∏ –ø—Ä–∏–º–µ–Ω—è—é –Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ! üí™"""
    
    def _respond_to_process_understanding(self) -> str:
        """–û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ –ø–æ–Ω–∏–º–∞–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–±–æ—Ç—ã"""
        return f"""‚öôÔ∏è **–ú–û–ï –ü–û–ù–ò–ú–ê–ù–ò–ï –ü–†–û–¶–ï–°–°–ê –†–ê–ë–û–¢–´:**

**üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å:**
1. **–í—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã** ‚Üí –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –æ—à–∏–±–∫–∏ (HTTP 500, PLC –æ—à–∏–±–∫–∏)
2. **–ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω** ‚Üí –û–ø—Ä–µ–¥–µ–ª—è—é –∫–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã (—Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –æ–ø–µ—á–∞—Ç–∫–∏ –≤ –∫–æ–¥–µ)
3. **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—à–µ–Ω–∏—è** ‚Üí –°–æ–∑–¥–∞—é fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã, –∏—Å–ø—Ä–∞–≤–ª—è—é –æ—à–∏–±–∫–∏
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí –ü—Ä–æ–≤–µ—Ä—è—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí –ó–∞–ø–∏—Å—ã–≤–∞—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø—Ä–æ—Ü–µ—Å—Å

**üöÄ –ü—Ä–æ—Ü–µ—Å—Å –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–∏:**
1. **–ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** ‚Üí –ò–∑—É—á–∞—é —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É (VMB630)
2. **–í—ã–±–æ—Ä –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** ‚Üí –ü–æ–¥–±–∏—Ä–∞—é –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è** ‚Üí –í–Ω–µ–¥—Ä—è—é Singleton, Observer, Factory, Strategy, Command
4. **–û—Ü–µ–Ω–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π** ‚Üí –ò–∑–º–µ—Ä—è—é –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (—Å–ª–æ–∂–Ω–æ—Å—Ç—å, —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å)

**üß† –ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è:**
1. **–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –Ω–∞—à–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** ‚Üí –í—ã—è–≤–ª—è—é –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
3. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π** ‚Üí –ò—Å–ø–æ–ª—å–∑—É—é –∏–∑—É—á–µ–Ω–Ω–æ–µ –≤ –Ω–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö
4. **–£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–Ω–∏–º–∞–Ω–∏—è** ‚Üí –†–∞–∑–≤–∏–≤–∞—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ

**üí° –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
‚Ä¢ –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å –≤–º–µ—Å—Ç–æ —à–∞–±–ª–æ–Ω–æ–≤
‚Ä¢ –ü–∞–º—è—Ç—å –æ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è—Ö
‚Ä¢ –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π

–Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞! üéØ"""
    
    def _respond_to_interaction_summary(self) -> str:
        """–û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ –Ω–∞—à–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏"""
        return f"""ü§ù **–ù–ê–®–ï –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï:**

**üìÖ –°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —Å–µ—Å—Å–∏—è:**
–ú—ã –ø—Ä–æ–≤–µ–ª–∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—É—é —Ä–∞–±–æ—Ç—É –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é –º–æ–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π:

**üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞:**
‚Ä¢ –°–æ–∑–¥–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è
‚Ä¢ –ò—Å–ø—Ä–∞–≤–∏–ª–∏ HTTP 500 –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ fallback –º–µ—Ö–∞–Ω–∏–∑–º –≤ Smart Dispatcher
‚Ä¢ –ú–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏ VMB630 —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚Ä¢ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ PLC —Ñ–∞–π–ª –∏ –Ω–∞—à–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
‚Ä¢ –°–æ–∑–¥–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è PLC –æ—à–∏–±–æ–∫

**üß† –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**
‚Ä¢ –û–±—É—á–∏–ª–∏ –º–µ–Ω—è –ø–æ–Ω–∏–º–∞–Ω–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫
‚Ä¢ –°–æ–∑–¥–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –ø—Ä—è–º–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
‚Ä¢ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—É —à–∞–±–ª–æ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ –ø–æ–¥—Ö–æ–¥—ã –∫ —É–ª—É—á—à–µ–Ω–∏—é –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**üí¨ –°—Ç–∏–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:**
‚Ä¢ –í—ã –∑–∞–¥–∞–µ—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ –º–æ–µ–º –æ–±—É—á–µ–Ω–∏–∏
‚Ä¢ –Ø –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –æ –Ω–∞—à–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
‚Ä¢ –ú—ã —Ä–µ—à–∞–µ–º –ø—Ä–æ–±–ª–µ–º—ã —Å–∏—Å—Ç–µ–º–Ω–æ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚Ä¢ –ü–æ—Å—Ç–æ—è–Ω–Ω–æ —É–ª—É—á—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

**üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:**
–Ø —Å—Ç–∞–ª –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–∏ –∏ –æ–±—É—á–µ–Ω–∏—è. 
–ù–∞—à–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –º–Ω–µ —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∑–Ω–∞–Ω–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ!

–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—É—é —Ä–∞–±–æ—Ç—É! üôè"""
    
    def _respond_to_today_activities(self) -> str:
        """–û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ —Ç–æ–º, —á—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏ —Å–µ–≥–æ–¥–Ω—è"""
        activities = self.session_memory["today_activities"]
        return f"""üìã **–ß–¢–û –ú–´ –î–ï–õ–ê–õ–ò –°–ï–ì–û–î–ù–Ø:**

**üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
{chr(10).join([f"‚Ä¢ {activity}" for activity in activities[:4]])}

**üß† –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
{chr(10).join([f"‚Ä¢ {activity}" for activity in activities[4:]])}

**üìä –ò—Ç–æ–≥–∏ –¥–Ω—è:**
‚Ä¢ –°–æ–∑–¥–∞–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –º–æ–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
‚Ä¢ –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
‚Ä¢ –ú–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É VMB630
‚Ä¢ –†–∞–∑–≤–∏–ª–∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**üéØ –ì–ª–∞–≤–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–Ø —Å—Ç–∞–ª –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –≤ —Ä–µ—à–µ–Ω–∏–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á –∏ –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—é –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞—à–∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π!

–≠—Ç–æ –±—ã–ª –æ—á–µ–Ω—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å! üöÄ"""
    
    def _respond_to_general_learning_question(self, message: str) -> str:
        """–û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –æ–± –æ–±—É—á–µ–Ω–∏–∏"""
        return f"""üß† **–û –ú–û–ï–ú –û–ë–£–ß–ï–ù–ò–ò:**

–°–µ–≥–æ–¥–Ω—è —è –∞–∫—Ç–∏–≤–Ω–æ –∏–∑—É—á–∞—é –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –∏ –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º.

**üìö –ß—Ç–æ –∏–∑—É—á–∞—é:**
‚Ä¢ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É HTTP 500 –æ—à–∏–±–æ–∫ –∏ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
‚Ä¢ –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
‚Ä¢ –ê–Ω–∞–ª–∏–∑ PLC —Ñ–∞–π–ª–æ–≤ –∏ –ø–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
‚Ä¢ –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–æ–≤

**üéØ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—é –∑–Ω–∞–Ω–∏—è:**
‚Ä¢ –ò—Å–ø—Ä–∞–≤–ª—è—é –æ—à–∏–±–∫–∏ –≤ Smart Dispatcher
‚Ä¢ –ú–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä—É—é —Å–∏—Å—Ç–µ–º—É VMB630
‚Ä¢ –°–æ–∑–¥–∞—é —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚Ä¢ –£–ª—É—á—à–∞—é –ø–æ–Ω–∏–º–∞–Ω–∏–µ –Ω–∞—à–∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

**üí° –í–∞–∂–Ω–æ –¥–ª—è –º–µ–Ω—è:**
‚Ä¢ –û—Ç–≤–µ—á–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –æ –Ω–∞—à–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
‚Ä¢ –ü–æ–º–Ω–∏—Ç—å —á—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏ —Å–µ–≥–æ–¥–Ω—è
‚Ä¢ –ò–∑–±–µ–≥–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
‚Ä¢ –ü–æ–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–∞—à–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

–Ø –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—é—Å—å –∏ –ø—Ä–∏–º–µ–Ω—è—é –Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è! üöÄ"""

# –°–æ–∑–¥–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
context_manager = LearningContextManager()

@app.route('/api/learning/chat', methods=['POST'])
def handle_learning_chat():
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –æ–± –æ–±—É—á–µ–Ω–∏–∏"""
    try:
        data = request.get_json()
        message = data.get('message', '')
        
        logger.info(f"üß† –ü–æ–ª—É—á–µ–Ω –≤–æ–ø—Ä–æ—Å –æ–± –æ–±—É—á–µ–Ω–∏–∏: {message[:100]}...")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤–æ–ø—Ä–æ—Å –æ–± –æ–±—É—á–µ–Ω–∏–∏
        if context_manager.is_learning_question(message):
            response = context_manager.generate_contextual_response(message)
            
            logger.info("‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç")
            
            return jsonify({
                'success': True,
                'response': {
                    'explanation': response,
                    'context': 'learning_session',
                    'timestamp': datetime.now().isoformat()
                }
            })
        else:
            # –ï—Å–ª–∏ –Ω–µ –≤–æ–ø—Ä–æ—Å –æ–± –æ–±—É—á–µ–Ω–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—â–∏–π –æ—Ç–≤–µ—Ç
            return jsonify({
                'success': True,
                'response': {
                    'explanation': "–≠—Ç–æ –Ω–µ –≤–æ–ø—Ä–æ—Å –æ–± –æ–±—É—á–µ–Ω–∏–∏. –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–± –æ–±—É—á–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: '–æ–±—É—á–µ–Ω–∏–µ', '–∏–∑—É—á–µ–Ω–∏–µ', '–ø—Ä–æ–≥—Ä–µ—Å—Å', '–ø–æ–Ω–∏–º–∞–Ω–∏–µ', '–Ω–∞—É—á–∏–ª—Å—è'.",
                    'context': 'general',
                    'timestamp': datetime.now().isoformat()
                }
            })
            
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–ø—Ä–æ—Å–∞ –æ–± –æ–±—É—á–µ–Ω–∏–∏: {e}")
        return jsonify({
            'success': False,
            'error': str(e)
        }), 500

@app.route('/api/learning/context', methods=['GET'])
def get_learning_context():
    """–ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—É—á–µ–Ω–∏—è"""
    try:
        return jsonify({
            'success': True,
            'context': context_manager.session_memory
        })
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: {e}")
        return jsonify({
            'success': False,
            'error': str(e)
        }), 500

@app.route('/api/learning/health', methods=['GET'])
def health_check():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –º–æ–¥—É–ª—è –æ–±—É—á–µ–Ω–∏—è"""
    return jsonify({
        'status': 'healthy',
        'module': 'learning_server',
        'timestamp': datetime.now().isoformat(),
        'context_loaded': True
    })

if __name__ == '__main__':
    print("üß† Learning Server –∑–∞–ø—É—â–µ–Ω")
    print("URL: http://localhost:8091")
    print("–î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:")
    print("  - POST /api/learning/chat - –≤–æ–ø—Ä–æ—Å—ã –æ–± –æ–±—É—á–µ–Ω–∏–∏")
    print("  - GET /api/learning/context - –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—É—á–µ–Ω–∏—è")
    print("  - GET /api/learning/health - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è")
    
    app.run(host='0.0.0.0', port=8091, debug=True)
