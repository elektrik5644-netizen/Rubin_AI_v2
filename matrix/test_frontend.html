<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Frontend Rubin AI</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-section h3 {
            color: #4CAF50;
            margin-top: 0;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: #0078d4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #106ebe;
        }
        
        .btn.success {
            background: #4CAF50;
        }
        
        .btn.error {
            background: #f44336;
        }
        
        .btn.warning {
            background: #ff9800;
        }
        
        .test-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #3e3e42;
            border-radius: 5px;
            background: #1e1e1e;
            color: #d4d4d4;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .test-results {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 5px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 12px;
        }
        
        .result-item {
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 3px;
        }
        
        .result-pass {
            background: rgba(76, 175, 80, 0.2);
            border-left: 3px solid #4CAF50;
        }
        
        .result-fail {
            background: rgba(244, 67, 54, 0.2);
            border-left: 3px solid #f44336;
        }
        
        .result-warn {
            background: rgba(255, 152, 0, 0.2);
            border-left: 3px solid #ff9800;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #4CAF50;
        }
        
        .status-offline {
            background: #f44336;
        }
        
        .status-unknown {
            background: #ff9800;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label {
            font-size: 12px;
            color: #858585;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ –¢–µ—Å—Ç Frontend Rubin AI</h1>
            <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalTests">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="passedTests">0</div>
                <div class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="failedTests">0</div>
                <div class="stat-label">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="serverStatus">‚ùì</div>
                <div class="stat-label">–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞</div>
            </div>
        </div>

        <div class="test-section">
            <h3>üîó –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É</h3>
            <div class="test-controls">
                <button class="btn" onclick="testServerConnection()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
                <button class="btn" onclick="testHealthEndpoint()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /health</button>
            </div>
            <div class="test-results" id="connectionResults"></div>
        </div>

        <div class="test-section">
            <h3>üí¨ –¢–µ—Å—Ç —á–∞—Ç–∞</h3>
            <input type="text" class="test-input" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..." value="–ü—Ä–∏–≤–µ—Ç, Rubin! –ö–∞–∫ –¥–µ–ª–∞?">
            <div class="test-controls">
                <button class="btn" onclick="testChatMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                <button class="btn" onclick="testMultipleMessages()">–¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</button>
                <button class="btn" onclick="testChatPerformance()">–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
            </div>
            <div class="test-results" id="chatResults"></div>
        </div>

        <div class="test-section">
            <h3>üíª –¢–µ—Å—Ç –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞</h3>
            <textarea class="test-input" id="codeInput" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞...">def hello():
    print("Hello, World!")
    return "success"</textarea>
            <div class="test-controls">
                <button class="btn" onclick="testCodeAnalysis()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
                <button class="btn" onclick="testMultipleLanguages()">–¢–µ—Å—Ç —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤</button>
            </div>
            <div class="test-results" id="codeResults"></div>
        </div>

        <div class="test-section">
            <h3>üìÑ –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h3>
            <input type="file" class="test-input" id="fileInput" accept=".txt,.md,.py,.js,.html">
            <div class="test-controls">
                <button class="btn" onclick="testFileUpload()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
                <button class="btn" onclick="testTextUpload()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç</button>
                <button class="btn" onclick="testDatabaseStats()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î</button>
            </div>
            <div class="test-results" id="uploadResults"></div>
        </div>

        <div class="test-section">
            <h3>üîÑ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <div class="test-controls">
                <button class="btn success" onclick="runFullCycleTest()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç</button>
                <button class="btn warning" onclick="runPerformanceTest()">–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
                <button class="btn error" onclick="runErrorHandlingTest()">–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫</button>
                <button class="btn" onclick="clearAllResults()">–û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
            </div>
            <div class="test-results" id="fullCycleResults"></div>
        </div>
    </div>

    <script>
        const SERVER_URL = 'http://localhost:8083';
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0
        };

        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;
        }

        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `result-item result-${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            resultDiv.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            
            container.appendChild(resultDiv);
            container.scrollTop = container.scrollHeight;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            testStats.total++;
            if (type === 'pass') testStats.passed++;
            if (type === 'fail') testStats.failed++;
            updateStats();
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function clearAllResults() {
            const containers = ['connectionResults', 'chatResults', 'codeResults', 'uploadResults', 'fullCycleResults'];
            containers.forEach(clearResults);
            testStats = { total: 0, passed: 0, failed: 0 };
            updateStats();
        }

        async function testServerConnection() {
            addResult('connectionResults', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É...', 'info');
            
            try {
                const response = await fetch(`${SERVER_URL}/health`, {
                    method: 'GET',
                    timeout: 5000
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('connectionResults', `‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω: ${data.message}`, 'pass');
                    document.getElementById('serverStatus').textContent = 'üü¢';
                } else {
                    addResult('connectionResults', `‚ùå HTTP ${response.status}`, 'fail');
                    document.getElementById('serverStatus').textContent = 'üî¥';
                }
            } catch (error) {
                addResult('connectionResults', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'fail');
                document.getElementById('serverStatus').textContent = 'üî¥';
            }
        }

        async function testHealthEndpoint() {
            addResult('connectionResults', '–ü—Ä–æ–≤–µ—Ä–∫–∞ endpoint /health...', 'info');
            
            try {
                const response = await fetch(`${SERVER_URL}/health`);
                const data = await response.json();
                
                addResult('connectionResults', `‚úÖ Health endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç: ${JSON.stringify(data)}`, 'pass');
            } catch (error) {
                addResult('connectionResults', `‚ùå –û—à–∏–±–∫–∞ health endpoint: ${error.message}`, 'fail');
            }
        }

        async function testChatMessage() {
            const message = document.getElementById('chatInput').value;
            if (!message.trim()) {
                addResult('chatResults', '‚ùå –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'fail');
                return;
            }
            
            addResult('chatResults', `–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è: "${message}"`, 'info');
            
            try {
                const response = await fetch(`${SERVER_URL}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: message })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('chatResults', `‚úÖ –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: ${data.response.substring(0, 100)}...`, 'pass');
                } else {
                    addResult('chatResults', `‚ùå HTTP ${response.status}`, 'fail');
                }
            } catch (error) {
                addResult('chatResults', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'fail');
            }
        }

        async function testMultipleMessages() {
            const messages = [
                '–ü—Ä–∏–≤–µ—Ç, Rubin!',
                '–ö–∞–∫ –¥–µ–ª–∞?',
                '–ß—Ç–æ —Ç–∞–∫–æ–µ —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥?',
                '–ü–æ–º–æ–≥–∏ —Å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º',
                '–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å!'
            ];
            
            addResult('chatResults', `–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ${messages.length} —Å–æ–æ–±—â–µ–Ω–∏–π...`, 'info');
            
            for (let i = 0; i < messages.length; i++) {
                const message = messages[i];
                addResult('chatResults', `–¢–µ—Å—Ç ${i + 1}/${messages.length}: "${message}"`, 'info');
                
                try {
                    const response = await fetch(`${SERVER_URL}/api/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: message })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        addResult('chatResults', `‚úÖ –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω (${data.response.length} —Å–∏–º–≤–æ–ª–æ–≤)`, 'pass');
                    } else {
                        addResult('chatResults', `‚ùå HTTP ${response.status}`, 'fail');
                    }
                } catch (error) {
                    addResult('chatResults', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'fail');
                }
                
                // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        async function testChatPerformance() {
            const testMessage = '–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á–∞—Ç–∞';
            const iterations = 5;
            
            addResult('chatResults', `–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: ${iterations} –∑–∞–ø—Ä–æ—Å–æ–≤`, 'info');
            
            const times = [];
            
            for (let i = 0; i < iterations; i++) {
                const startTime = performance.now();
                
                try {
                    const response = await fetch(`${SERVER_URL}/api/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: `${testMessage} ${i + 1}` })
                    });
                    
                    const endTime = performance.now();
                    const responseTime = endTime - startTime;
                    times.push(responseTime);
                    
                    if (response.ok) {
                        addResult('chatResults', `‚úÖ –ó–∞–ø—Ä–æ—Å ${i + 1}: ${responseTime.toFixed(2)}–º—Å`, 'pass');
                    } else {
                        addResult('chatResults', `‚ùå –ó–∞–ø—Ä–æ—Å ${i + 1}: HTTP ${response.status}`, 'fail');
                    }
                } catch (error) {
                    addResult('chatResults', `‚ùå –ó–∞–ø—Ä–æ—Å ${i + 1}: ${error.message}`, 'fail');
                }
            }
            
            if (times.length > 0) {
                const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
                const maxTime = Math.max(...times);
                const minTime = Math.min(...times);
                
                addResult('chatResults', 
                    `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –°—Ä–µ–¥–Ω–µ–µ: ${avgTime.toFixed(2)}–º—Å, –ú–∞–∫—Å: ${maxTime.toFixed(2)}–º—Å, –ú–∏–Ω: ${minTime.toFixed(2)}–º—Å`, 
                    'info');
            }
        }

        async function testCodeAnalysis() {
            const code = document.getElementById('codeInput').value;
            if (!code.trim()) {
                addResult('codeResults', '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞', 'fail');
                return;
            }
            
            addResult('codeResults', '–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞...', 'info');
            
            try {
                const response = await fetch(`${SERVER_URL}/api/code/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        code: code, 
                        language: 'python' 
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('codeResults', `‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞: ${data.quality_score || 'N/A'}`, 'pass');
                    
                    if (data.issues && data.issues.length > 0) {
                        addResult('codeResults', `–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º: ${data.issues.length}`, 'warn');
                    }
                    
                    if (data.recommendations && data.recommendations.length > 0) {
                        addResult('codeResults', `–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π: ${data.recommendations.length}`, 'info');
                    }
                } else {
                    addResult('codeResults', `‚ùå HTTP ${response.status}`, 'fail');
                }
            } catch (error) {
                addResult('codeResults', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'fail');
            }
        }

        async function testMultipleLanguages() {
            const testCases = [
                { code: 'def hello():\n    print("Hello")', language: 'python' },
                { code: 'if (x > 0) {\n    printf("Positive");\n}', language: 'c' },
                { code: 'SELECT * FROM users;', language: 'sql' }
            ];
            
            addResult('codeResults', `–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ${testCases.length} —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è...`, 'info');
            
            for (const testCase of testCases) {
                addResult('codeResults', `–¢–µ—Å—Ç ${testCase.language}...`, 'info');
                
                try {
                    const response = await fetch(`${SERVER_URL}/api/code/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(testCase)
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        addResult('codeResults', `‚úÖ ${testCase.language}: –∞–Ω–∞–ª–∏–∑ —É—Å–ø–µ—à–µ–Ω`, 'pass');
                    } else {
                        addResult('codeResults', `‚ùå ${testCase.language}: HTTP ${response.status}`, 'fail');
                    }
                } catch (error) {
                    addResult('codeResults', `‚ùå ${testCase.language}: ${error.message}`, 'fail');
                }
            }
        }

        async function testFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                addResult('uploadResults', '‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'fail');
                return;
            }
            
            addResult('uploadResults', `–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞: ${file.name}`, 'info');
            
            try {
                const content = await file.text();
                
                const response = await fetch(`${SERVER_URL}/api/documents/upload-content`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        filename: file.name,
                        content: content,
                        category: 'test',
                        tags: ['test', 'upload']
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('uploadResults', `‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: ${data.message || 'OK'}`, 'pass');
                } else {
                    addResult('uploadResults', `‚ùå HTTP ${response.status}`, 'fail');
                }
            } catch (error) {
                addResult('uploadResults', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'fail');
            }
        }

        async function testTextUpload() {
            const testContent = `–¢–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
–°–æ–∑–¥–∞–Ω: ${new Date().toLocaleString()}
–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Rubin AI`;

            addResult('uploadResults', '–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞...', 'info');
            
            try {
                const response = await fetch(`${SERVER_URL}/api/documents/upload-content`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        filename: 'test_document.txt',
                        content: testContent,
                        category: 'test',
                        tags: ['test', 'text', 'upload']
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('uploadResults', `‚úÖ –¢–µ–∫—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω: ${data.message || 'OK'}`, 'pass');
                } else {
                    addResult('uploadResults', `‚ùå HTTP ${response.status}`, 'fail');
                }
            } catch (error) {
                addResult('uploadResults', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'fail');
            }
        }

        async function testDatabaseStats() {
            addResult('uploadResults', '–ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...', 'info');
            
            try {
                const response = await fetch(`${SERVER_URL}/api/documents/stats`);
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('uploadResults', `‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞: ${JSON.stringify(data)}`, 'pass');
                } else {
                    addResult('uploadResults', `‚ùå HTTP ${response.status}`, 'fail');
                }
            } catch (error) {
                addResult('uploadResults', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'fail');
            }
        }

        async function runFullCycleTest() {
            addResult('fullCycleResults', 'üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...', 'info');
            
            // –¢–µ—Å—Ç 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
            addResult('fullCycleResults', '–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'info');
            await testServerConnection();
            
            // –¢–µ—Å—Ç 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            addResult('fullCycleResults', '–¢–µ—Å—Ç 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç', 'info');
            document.getElementById('chatInput').value = '–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Rubin AI';
            await testChatMessage();
            
            // –¢–µ—Å—Ç 3: –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
            addResult('fullCycleResults', '–¢–µ—Å—Ç 3: –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞', 'info');
            document.getElementById('codeInput').value = 'def test_function():\n    return "test"';
            await testCodeAnalysis();
            
            // –¢–µ—Å—Ç 4: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            addResult('fullCycleResults', '–¢–µ—Å—Ç 4: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞', 'info');
            await testTextUpload();
            
            addResult('fullCycleResults', '‚úÖ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω!', 'pass');
        }

        async function runPerformanceTest() {
            addResult('fullCycleResults', '‚ö° –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...', 'info');
            
            const startTime = performance.now();
            
            // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
            const promises = [];
            for (let i = 0; i < 5; i++) {
                promises.push(
                    fetch(`${SERVER_URL}/api/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: `–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ${i + 1}` })
                    })
                );
            }
            
            try {
                const responses = await Promise.all(promises);
                const endTime = performance.now();
                const totalTime = endTime - startTime;
                
                const successCount = responses.filter(r => r.ok).length;
                addResult('fullCycleResults', 
                    `‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω: ${successCount}/5 —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ ${totalTime.toFixed(2)}–º—Å`, 
                    'pass');
            } catch (error) {
                addResult('fullCycleResults', `‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: ${error.message}`, 'fail');
            }
        }

        async function runErrorHandlingTest() {
            addResult('fullCycleResults', 'üõ°Ô∏è –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫...', 'info');
            
            const errorTests = [
                { name: '–ü—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', data: { message: '' } },
                { name: '–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', data: { message: 'x'.repeat(10000) } },
                { name: '–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π endpoint', url: '/api/nonexistent' }
            ];
            
            for (const test of errorTests) {
                addResult('fullCycleResults', `–¢–µ—Å—Ç: ${test.name}`, 'info');
                
                try {
                    const url = test.url ? `${SERVER_URL}${test.url}` : `${SERVER_URL}/api/chat`;
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(test.data || {})
                    });
                    
                    if (response.status >= 400) {
                        addResult('fullCycleResults', `‚úÖ ${test.name}: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –æ—à–∏–±–∫–∞ (HTTP ${response.status})`, 'pass');
                    } else {
                        addResult('fullCycleResults', `‚ö†Ô∏è ${test.name}: –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å (HTTP ${response.status})`, 'warn');
                    }
                } catch (error) {
                    addResult('fullCycleResults', `‚úÖ ${test.name}: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –æ—à–∏–±–∫–∞ (${error.message})`, 'pass');
                }
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            testServerConnection();
        });
    </script>
</body>
</html>
