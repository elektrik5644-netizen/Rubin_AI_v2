# Rubin AI v2 - Enhanced Smart Dispatcher

## 🚀 Обзор

Rubin AI v2 - это интеллектуальная система маршрутизации запросов с интеграцией нейронной сети, базы знаний и специализированных обработчиков. Система обеспечивает точную категоризацию и маршрутизацию пользовательских запросов к соответствующим модулям.

## ✨ Основные возможности

- **🧠 Нейронная сеть**: Интеллектуальная категоризация запросов
- **📚 База знаний**: Приоритетный поиск в базе знаний
- **🔀 Умная маршрутизация**: Автоматическое определение подходящего модуля
- **⚡ Внутренние обработчики**: Быстрая обработка без сетевых задержек
- **📊 Детальная аналитика**: Мониторинг производительности и ошибок
- **🔧 Гибкая архитектура**: Легкое добавление новых модулей

## 🏗️ Архитектура

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Telegram Bot  │    │  Web Interface   │    │   API Clients   │
└─────────┬───────┘    └─────────┬────────┘    └─────────┬───────┘
          │                      │                       │
          └──────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │  Enhanced Smart Dispatcher │
                    │                           │
                    │  ┌─────────────────────┐  │
                    │  │   Neural Router     │  │
                    │  │   - Классификация   │  │
                    │  │   - Маршрутизация   │  │
                    │  └─────────────────────┘  │
                    │                           │
                    │  ┌─────────────────────┐  │
                    │  │  Knowledge Base     │  │
                    │  │  - Семантический    │  │
                    │  │    поиск            │  │
                    │  └─────────────────────┘  │
                    └─────────────┬─────────────┘
                                  │
                    ┌─────────────▼─────────────┐
                    │    Internal Handlers      │
                    │                           │
                    │  ┌─────────────────────┐  │
                    │  │  General Handler    │  │
                    │  │  - Приветствия      │  │
                    │  │  - Справка          │  │
                    │  └─────────────────────┘  │
                    │                           │
                    │  ┌─────────────────────┐  │
                    │  │ Electrical Handler  │  │
                    │  │  - Законы Ома       │  │
                    │  │  - Компоненты       │  │
                    │  └─────────────────────┘  │
                    │                           │
                    │  ┌─────────────────────┐  │
                    │  │Mathematics Handler  │  │
                    │  │  - Расчеты          │  │
                    │  │  - Формулы          │  │
                    │  └─────────────────────┘  │
                    └───────────────────────────┘
```

## 🚀 Быстрый старт

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Запуск системы

```bash
# Запуск основного диспетчера
python enhanced_smart_dispatcher.py

# Запуск в Docker
docker-compose -f docker-compose.telegram.yml up -d
```

### 3. Проверка работы

```bash
# Проверка здоровья
curl http://localhost:8080/api/health

# Тестовый запрос
curl -X POST http://localhost:8080/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "привет"}'
```

## 📡 API Endpoints

### Основные endpoints

- `POST /api/chat` - Основной чат endpoint
- `GET /api/health` - Проверка здоровья
- `GET /api/servers` - Список серверов
- `GET /api/errors` - Ошибки системы
- `GET /api/system/health` - Здоровье системы
- `POST /api/neural/analyze` - Нейронный анализ
- `GET /api/status` - Статус маршрутизатора

### Примеры запросов

#### Чат запрос
```bash
curl -X POST http://localhost:8080/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "что такое транзистор"}'
```

#### Нейронный анализ
```bash
curl -X POST http://localhost:8080/api/neural/analyze \
  -H "Content-Type: application/json" \
  -d '{"message": "закон кирхгофа"}'
```

## 🧠 Нейронная сеть

### Обучение

Система использует предобученную нейронную сеть с возможностью дообучения:

```python
from neural_rubin import get_neural_rubin

# Получение экземпляра
neural_ai = get_neural_rubin()

# Обучение на основе обратной связи
neural_ai.learn_from_feedback(
    question="новый вопрос",
    correct_category="правильная_категория",
    user_rating=5
)

# Обучение на датасете
neural_ai.train_neural_network(
    training_file='neural_training_data.jsonl',
    num_epochs=10
)
```

### Категории

Система поддерживает следующие категории:
- `общие` - Приветствия, справка, общие вопросы
- `математика` - Расчеты, формулы, уравнения
- `электротехника` - Компоненты, законы, схемы
- `программирование` - Код, алгоритмы, языки
- `технические` - Контроллеры, сервоприводы, PLC
- `системные` - Диагностика, мониторинг, оптимизация

## 🔧 Внутренние обработчики

### General Handler
Обрабатывает общие запросы:
- Приветствия
- Справка и помощь
- Статус системы

### Electrical Handler
Специализируется на электротехнике:
- Определения компонентов
- Законы Ома, Кирхгофа
- Расчеты параметров

### Mathematics Handler
Обрабатывает математические запросы:
- Арифметические операции
- Геометрические расчеты
- Тригонометрические функции

## 📊 Мониторинг и аналитика

### Логирование

Система ведет детальные логи:
- `enhanced_dispatcher.log` - Основные логи
- Нейронная сеть - категоризация
- Маршрутизация - выбор серверов
- База знаний - поиск и результаты

### Метрики

- Время обработки запросов
- Успешность маршрутизации
- Использование категорий
- Ошибки и их типы

## 🧪 Тестирование

### Запуск тестов

```bash
# Тесты диспетчера
python test_enhanced_dispatcher.py

# Тесты нейронной сети
python test_neural_training.py

# Все тесты
python -m pytest test_*.py -v
```

### Тестовые сценарии

- Проверка здоровья системы
- Нейронная классификация
- Маршрутизация запросов
- Обработка ошибок
- Производительность

## 🐳 Docker

### Запуск в Docker

```bash
# Сборка образа
docker build -f Dockerfile.smart-dispatcher -t rubin-smart-dispatcher .

# Запуск с Telegram ботом
docker-compose -f docker-compose.telegram.yml up -d
```

### Переменные окружения

```bash
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token

# Настройки логирования
LOG_LEVEL=INFO
LOG_FILE=enhanced_dispatcher.log
```

## 🔧 Конфигурация

### Настройка серверов

В `enhanced_smart_dispatcher.py`:

```python
SERVERS = {
    "general": {
        "port": 8085,
        "endpoint": "/api/chat",
        "method": "POST",
        "keywords": ["привет", "помощь"],
        "priority": 1
    },
    # ... другие серверы
}
```

### Настройка нейронной сети

В `neural_rubin.py`:

```python
# Категории
self.categories = [
    'математика', 'физика', 'электротехника',
    'программирование', 'общие_вопросы'
]

# Архитектура сети
self.neural_network = RubinNeuralNetwork(
    input_size=768,
    hidden_sizes=[1536, 768, 384],
    num_classes=len(self.categories)
)
```

## 🚨 Устранение неполадок

### Частые проблемы

1. **Сервер недоступен**
   - Проверьте порты
   - Убедитесь, что сервисы запущены
   - Проверьте логи

2. **Низкая точность классификации**
   - Добавьте обучающие данные
   - Переобучите модель
   - Проверьте ключевые слова

3. **Медленная работа**
   - Оптимизируйте запросы
   - Проверьте производительность
   - Увеличьте таймауты

### Логи и отладка

```bash
# Просмотр логов
tail -f enhanced_dispatcher.log

# Логи Docker
docker logs rubin_ai_v2-rubin-smart-dispatcher-1

# Проверка здоровья
curl http://localhost:8080/api/system/health
```

## 📈 Производительность

### Оптимизация

- Использование внутренних обработчиков
- Кэширование результатов
- Асинхронная обработка
- Оптимизация нейронной сети

### Мониторинг

- Время ответа < 1 секунды
- Точность классификации > 90%
- Доступность > 99.9%

## 🤝 Вклад в проект

1. Форкните репозиторий
2. Создайте ветку для новой функции
3. Внесите изменения
4. Добавьте тесты
5. Создайте Pull Request

## 📄 Лицензия

MIT License

## 📞 Поддержка

- Создайте Issue в GitHub
- Проверьте документацию
- Изучите логи системы

---

**Rubin AI v2** - Интеллектуальная система маршрутизации с нейронной сетью